---
globs: "**/README.md,**/*.md"
description: Documentation standards and formatting rules for README and markdown files
---

# ドキュメンテーション規則

このルールは Markdown ファイル (`*.md`) に適用されます。

## 基本原則

### 言語使用規則
- **メインドキュメント**: 日本語で記述
- **技術用語**: 英語併記を推奨 (例: "コンテナ (container)")
- **コードコメント**: 英語で記述  
- **コマンド説明**: 日本語
- **エラーメッセージ**: 原文のまま (通常英語)

### ファイル構造規則
```
プロジェクトルート/
├── README.md              # プロジェクト全体の概要 (日本語)
├── docs/
│   ├── {component}/
│   │   ├── README.md      # コンポーネント固有のドキュメント (日本語)
│   │   ├── manifests/     # Kubernetes マニフェスト
│   │   └── argocd/        # ArgoCD Application定義
│   └── ...
└── k0s/
    └── README.md          # k0s クラスター管理ドキュメント (日本語)
```

## README.md 構造パターン

### プロジェクトルート README
```markdown
# {プロジェクト名}

## このドキュメントでできること

### 1. {主要機能1}
{簡潔な説明}

### 2. {主要機能2}  
{簡潔な説明}

## 発展
{関連プロジェクトやエコシステムへの言及}

## 目次
- [Versions](#versions)
- [0. 前準備](#0-前準備)
- [セットアップ手順](#セットアップ手順)

## Versions
{使用するツールとバージョンの一覧}

## 前準備
{必要な環境やツールの準備}

## セットアップ手順
{段階的なセットアップ手順}

## 参考
{外部リンクや参考資料}
```

### コンポーネント別 README
```markdown
# {コンポーネント名} - {役割の説明}

## 概要
{コンポーネントの目的と機能}

## 前提条件
{必要な前提条件}

## セットアップ手順

### 1. {ステップ1}
{詳細な手順}

### 2. {ステップ2}  
{詳細な手順}

## 設定

### {設定項目1}
{設定の説明}

### {設定項目2}
{設定の説明}

## 使用方法
{基本的な使用方法}

## トラブルシューティング

### {問題1}
{解決方法}

### {問題2}
{解決方法}

## 参考リンク
{関連ドキュメントへのリンク}
```

## フォーマット規則

### 見出し
```markdown
# レベル1: ページタイトル (1つのみ)
## レベル2: 主要セクション
### レベル3: サブセクション
#### レベル4: 詳細項目 (必要に応じて)
```

### リスト
```markdown
# 番号付きリスト (手順)
1. 最初の手順
2. 次の手順
3. 最後の手順

# 箇条書き (項目列挙)
- 項目1
- 項目2
  - サブ項目2.1
  - サブ項目2.2
- 項目3
```

### コードブロック
```markdown
# コマンドの例
```bash
# コメント
kubectl apply -f manifest.yaml
```

# 設定ファイルの例
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: example
```

# インラインコード
`kubectl get pods` コマンドを実行して確認してください。
```

### リンク
```markdown
# 内部リンク (プロジェクト内)
[手順](docs/1-argocd/README.md)

# 外部リンク
[k0s公式ドキュメント](https://docs.k0sproject.io/)

# アンカーリンク (同一ページ内)
[目次](#目次)
```

### 画像
```markdown
# 画像の埋め込み
![alt text](imgs/argocd.png "ArgoCD")

# 説明的なalt textを使用
![ArgoCD ダッシュボードのスクリーンショット](imgs/argocd.png "ArgoCD")
```

### 表
```markdown
| ツール | バージョン | 用途 |
|-------|----------|------|
| k0sctl | v0.23.0 | クラスター管理 |
| kubectl | 1.32.3 | Kubernetes操作 |
| helm | 3.17.2 | パッケージ管理 |
```

### 引用と注意事項
```markdown
> **注意**: この操作はクラスター全体に影響します。

> **ヒント**: 設定を変更する前にバックアップを取ることをお勧めします。

> **重要**: 本番環境では必ず事前にテスト環境で検証してください。
```

## コンテンツ規則

### 手順の記述
```markdown
## セットアップ手順

### 1. 前準備

前提条件を確認してください：
- k0sctl がインストールされていること
- SSH 接続が可能であること

### 2. クラスターの構築

```bash
# k0sctl.yml の確認
cat k0sctl.yml

# クラスター構築の実行
make apply
```

### 3. 確認

正常に構築されたことを確認：

```bash
# ノードの状態確認
kubectl get nodes
```

期待される出力:
```
NAME            STATUS   ROLES           AGE   VERSION
controller-01   Ready    control-plane   1m    v1.29.1+k0s
worker-01       Ready    <none>          1m    v1.29.1+k0s
```
```

### コマンドの説明
```markdown
# コマンドの実行例
```bash
# コメントでコマンドの目的を説明
kubectl apply -f manifest.yaml

# 複数行コマンドの場合は \ で継続
kubectl create secret generic my-secret \
  --from-literal=username=admin \
  --from-literal=password=secretpassword
```
```

### 設定ファイルの説明
```markdown
### k0sctl.yml の設定

クラスター構成ファイルの重要な項目：

```yaml
spec:
  hosts:
    - ssh:
        address: 192.168.11.221  # コントローラーノードのIP
        user: aoba               # SSH ユーザー
      role: controller           # ノードの役割
```

各項目の説明：
- `address`: ノードのIPアドレス
- `user`: SSH接続に使用するユーザー名
- `role`: ノードの役割 (controller または worker)
```

### トラブルシューティングの記述
```markdown
## トラブルシューティング

### SSH 接続エラー

**症状**: `k0sctl apply` 実行時に SSH 接続が失敗する

**原因**: SSH 鍵の設定またはネットワーク接続の問題

**解決方法**:

1. SSH 接続の確認
   ```bash
   ssh aoba@192.168.11.221
   ```

2. SSH 鍵の確認
   ```bash
   ssh-add -l
   ```

3. SSH エージェントの起動 (必要に応じて)
   ```bash
   eval $(ssh-agent)
   ssh-add ~/.ssh/id_rsa
   ```
```

## バージョン管理

### バージョン情報の記載
```markdown
## Versions

使用しているツールのバージョン:

- asdf: v0.16.6
- k0sctl: v0.23.0
- k9s: v0.40.10
- helm: 3.17.2
- kubectl: 1.32.3
- argocd: 2.14.7

最終更新: 2024-03-15
```

### 変更履歴
```markdown
## 変更履歴

### v1.2.0 (2024-03-15)
- Harbor の設定を追加
- cert-manager の自動証明書発行機能を有効化

### v1.1.0 (2024-03-10)  
- Rook Ceph ストレージの設定を改善
- k0s クラスターの監視機能を追加

### v1.0.0 (2024-03-01)
- 初期リリース
- 基本的な k0s + ArgoCD 構成
```

## リンクと参照

### 内部参照
```markdown
# プロジェクト内のファイル参照
詳細な手順は [ArgoCD セットアップガイド](docs/1-argocd/README.md) を参照してください。

# 設定ファイルの参照
クラスター設定は [k0sctl.yml](k0s/k0sctl.yml) で定義されています。
```

### 外部リンク
```markdown
# 公式ドキュメント
- [k0s 公式ドキュメント](https://docs.k0sproject.io/)
- [ArgoCD 公式ドキュメント](https://argo-cd.readthedocs.io/)

# GitHub リポジトリ
- [Rook プロジェクト](https://github.com/rook/rook)
```

## アクセシビリティと可読性

### 見出しの階層
- 論理的な見出し階層を維持
- セクション間に適切な空行を挿入
- 長い文書では目次を提供

### 専門用語の説明
```markdown
ArgoCD は GitOps の原則に基づく継続的デリバリーツールです。
Kubernetes クラスター上でアプリケーションの自動デプロイメントを管理します。

用語解説:
- **GitOps**: Git リポジトリを単一の信頼できるソースとする運用手法
- **継続的デリバリー**: ソフトウェアを安全かつ迅速にリリースする手法
```

### コードの可読性
- コマンドには説明コメントを追加
- 長いコマンドは適切に改行
- 重要な設定項目は別途説明を追加

## 品質チェック

### レビューポイント
1. **正確性**: 記載された手順が実際に動作するか
2. **完全性**: 必要な前提条件や設定がすべて記載されているか
3. **明確性**: 初心者でも理解できる説明になっているか
4. **最新性**: バージョン情報や手順が最新のものか

### 検証方法
```bash
# Markdown の構文チェック
markdownlint README.md

# リンクの有効性チェック
markdown-link-check README.md

# 日本語の校正チェック (利用可能な場合)
textlint README.md
```

参考ファイル:
- [プロジェクト README](mdc:README.md) - 全体構造の例
- [k0s README](mdc:k0s/README.md) - コンポーネント別ドキュメントの例
- [ArgoCD README](mdc:docs/1-argocd/README.md) - セットアップ手順の例
- [Rook Ceph README](mdc:docs/3-rook-ceph-pvc/README.md) - トラブルシューティングの例
