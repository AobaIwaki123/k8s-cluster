---
alwaysApply: true
---

# k8s Cluster Project - プロジェクト概要

## プロジェクトコンテキスト
これは k0s、ArgoCD、および各種クラウドネイティブツールを使用した Kubernetes クラスターセットアップ項目です。Infrastructure as Code (IaC) と GitOps 原則に重点を置いています。

メインの設定ファイル:
- [k0sctl.yml](mdc:k0s/k0sctl.yml) - k0sクラスター設定
- [Makefile](mdc:k0s/Makefile) - クラスター管理コマンド
- [README.md](mdc:README.md) - プロジェクト全体の説明

## テクノロジースタック
- **Kubernetes Distribution**: k0s (軽量 Kubernetes)
- **Cluster Management**: k0sctl
- **GitOps**: ArgoCD
- **Package Manager**: Helm
- **Ingress**: Cloudflare Tunnel Ingress Controller
- **Storage**: Rook Ceph
- **Certificate Management**: cert-manager + Let's Encrypt
- **Container Registry**: Harbor
- **Languages**: YAML, Go templates (Helm), Makefile, Markdown

## プロジェクト構造
```
docs/                   # 各コンポーネントのドキュメントとマニフェスト
├── 0-asdf/            # asdf ツール管理
├── 1-argocd/          # ArgoCD 設定
├── 2-cloudflare-ingress-controller/  # Cloudflare Ingress
├── 3-rook-ceph-pvc/   # Rook Ceph ストレージ
├── 4-cert-manager/    # 証明書管理
├── 5-harbor/          # コンテナレジストリ
├── firebolt-core/     # Firebolt データベース
├── istio/             # サービスメッシュ (オプション)
├── minio/             # オブジェクトストレージ (オプション)  
└── nginx/             # Nginx Ingress (オプション)

k0s/                   # k0s クラスター設定
├── k0sctl.yml         # クラスター構成定義
├── Makefile           # 管理コマンド
└── README.md          # k0s 固有の説明

.cursor/rules/         # Cursor エディタルール
```

### ディレクトリ構造規則
各 `docs/{component-name}/` には以下の構造を使用:
- `argocd/` - ArgoCD Application 定義
- `manifests/` - 生の Kubernetes マニフェスト
- `helm/` - Helm チャート (該当する場合)
- `README.md` - コンポーネント固有のドキュメント (日本語)

## 重要な設計原則

### ファイル命名規則
- **Kubernetes manifests**: ケバブケースで説明的な名前を使用
  例: `argocd-cm.yml`, `clusterissuer-letsencrypt.yaml`
- **ArgoCD Applications**: コンポーネント名を使用
  例: `harbor.yaml`, `cert-manager.yaml`
- **Helm charts**: Helm 規約に従う
  例: `Chart.yaml`, `values.yaml`, `_helpers.tpl`

### デプロイメント順序
1. k0s クラスター構築 ([k0s/](mdc:k0s/))
2. ArgoCD セットアップ ([docs/1-argocd/](mdc:docs/1-argocd/))
3. Cloudflare Ingress Controller ([docs/2-cloudflare-ingress-controller/](mdc:docs/2-cloudflare-ingress-controller/))
4. Storage (Rook Ceph) ([docs/3-rook-ceph-pvc/](mdc:docs/3-rook-ceph-pvc/))
5. Certificate Manager ([docs/4-cert-manager/](mdc:docs/4-cert-manager/))
6. Harbor Registry ([docs/5-harbor/](mdc:docs/5-harbor/))
7. その他のアプリケーション

### 開発ワークフロー
- Infrastructure as Code 原則に従う
- すべての変更をバージョン管理し、テストし、適切にドキュメント化する
- 日本語でドキュメントを作成、コードコメントは英語
- `kubectl dry-run` でマニフェストをテストしてからコミット
- Helm チャートは `helm lint` と `helm template` で検証
