<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>ArgoCD - k8s Cluster on Proxmox</title>
    <meta name="description" content="ArgoCDのインストールと設定方法" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Syntax Highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="header-container">
        <a href="../" class="logo">
          <i class="fas fa-cubes logo-icon"></i>
          <span class="logo-text">k8s Cluster</span>
        </a>

        <div class="header-actions">
          <button class="theme-toggle" aria-label="Toggle theme">
            <i class="fas fa-moon theme-icon"></i>
          </button>

          <button class="mobile-menu-toggle" aria-label="Toggle menu">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay"></div>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Navigation will be rendered by JavaScript -->
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <div class="content-container">
          <!-- Breadcrumb -->
          <nav class="breadcrumb">
            <div class="breadcrumb-item">
              <a href="../" class="breadcrumb-link">
                <i class="fas fa-home"></i> Home
              </a>
            </div>
            <span class="breadcrumb-separator">/</span>
            <div class="breadcrumb-item">
              <span class="breadcrumb-current">ArgoCD</span>
            </div>
          </nav>

          <!-- Article Content -->
          <article class="article-content">
            <h1>ArgoCD</h1>

            <p>
              ArgoCDは、Kubernetes向けの宣言的GitOpsツールです。GitリポジトリをSingle
              Source of Truthとして、Kubernetesクラスターの状態を管理します。
            </p>

            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i>
              <p>
                ArgoCDは、GitOps原則に基づいてKubernetesアプリケーションのデプロイメントを自動化します。
              </p>
            </div>

            <h2>概要</h2>

            <p>ArgoCDの主な特徴：</p>
            <ul>
              <li>宣言的なGitOps CD（Continuous Delivery）</li>
              <li>Kubernetesマニフェストの自動同期</li>
              <li>WebベースのUIとCLI</li>
              <li>マルチクラスター管理</li>
              <li>SSO統合サポート</li>
              <li>Helm、Kustomize、Ksonnetなど複数のテンプレートツール対応</li>
            </ul>

            <h2>インストール</h2>

            <h3>1. 名前空間の作成</h3>

            <pre><code class="language-bash">kubectl create namespace argocd</code></pre>

            <h3>2. ArgoCDのインストール</h3>

            <pre><code class="language-bash">kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code></pre>

            <h3>3. ArgoCDサーバーのアクセス確認</h3>

            <p>Ingressを設定するまで、Port Forwardingでアクセスできます。</p>

            <pre><code class="language-bash">kubectl port-forward svc/argocd-server -n argocd 8080:443</code></pre>

            <h2>初期設定</h2>

            <h3>初期パスワードの取得</h3>

            <p>初期管理者パスワードは自動生成されます。</p>

            <pre><code class="language-bash">kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d</code></pre>

            <h3>CLIでのログイン</h3>

            <pre><code class="language-bash">argocd login localhost:8080 --username admin --password &lt;パスワード&gt; --insecure</code></pre>

            <h3>パスワードの変更</h3>

            <pre><code class="language-bash">argocd account update-password</code></pre>

            <h2>アプリケーションのデプロイ</h2>

            <h3>Application リソースの作成</h3>

            <p>
              ArgoCD
              Applicationリソースを使用して、GitリポジトリからKubernetesリソースをデプロイします。
            </p>

            <pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: example-app
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/your-org/your-repo
    targetRevision: HEAD
    path: manifests
  destination:
    server: https://kubernetes.default.svc
    namespace: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true</code></pre>

            <h3>アプリケーションの作成</h3>

            <pre><code class="language-bash">kubectl apply -f application.yaml</code></pre>

            <h2>主要な機能</h2>

            <h3>自動同期</h3>

            <p>
              <code>syncPolicy.automated</code
              >を設定すると、Gitリポジトリの変更を自動的に検出してデプロイします。
            </p>

            <h3>セルフヒール</h3>

            <p>
              <code>selfHeal: true</code
              >を設定すると、クラスター内の状態がGitと異なる場合、自動的に修正します。
            </p>

            <h3>プルーニング</h3>

            <p>
              <code>prune: true</code
              >を設定すると、Gitから削除されたリソースをクラスターからも削除します。
            </p>

            <h2>ベストプラクティス</h2>

            <ul>
              <li>
                <strong>App of Apps パターン</strong>:
                ルートApplicationから他のApplicationをデプロイ
              </li>
              <li>
                <strong>環境ごとの分離</strong>: 各環境（dev, staging,
                prod）に別々のApplicationを作成
              </li>
              <li>
                <strong>Projectの活用</strong>:
                チームやアプリケーションごとにProjectを作成してアクセス制御
              </li>
              <li><strong>Sync Waves</strong>: リソースのデプロイ順序を制御</li>
              <li>
                <strong>Health Check</strong>:
                カスタムヘルスチェックで正確なステータス監視
              </li>
            </ul>

            <h2>トラブルシューティング</h2>

            <h3>同期エラー</h3>

            <pre><code class="language-bash"># アプリケーションの詳細を確認
argocd app get &lt;app-name&gt;

# ログの確認
kubectl logs -n argocd deployment/argocd-application-controller</code></pre>

            <h3>リソースの強制同期</h3>

            <pre><code class="language-bash">argocd app sync &lt;app-name&gt; --force</code></pre>

            <h2>参考リンク</h2>

            <ul>
              <li>
                <a
                  href="https://argo-cd.readthedocs.io/"
                  target="_blank"
                  rel="noopener noreferrer"
                  >ArgoCD公式ドキュメント</a
                >
              </li>
              <li>
                <a
                  href="https://github.com/argoproj/argo-cd"
                  target="_blank"
                  rel="noopener noreferrer"
                  >ArgoCD GitHub</a
                >
              </li>
            </ul>
          </article>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
          <div class="footer-container">
            <p class="footer-text">
              &copy; 2025 k8s Cluster on Proxmox. Built with
              <i class="fas fa-heart footer-heart"></i> and Kubernetes.
            </p>
            <div class="footer-links">
              <a
                href="https://github.com"
                target="_blank"
                rel="noopener noreferrer"
                class="footer-link"
              >
                <i class="fab fa-github"></i> GitHub
              </a>
            </div>
          </div>
        </footer>
      </main>

      <!-- Table of Contents -->
      <aside class="toc-container">
        <!-- TOC will be generated by JavaScript -->
      </aside>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" aria-label="Scroll to top">
      <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/theme.js"></script>
    <script src="../assets/js/navigation.js"></script>
    <script src="../assets/js/toc.js"></script>
    <script src="../assets/js/code-highlight.js"></script>
    <script src="../assets/js/page-navigation.js"></script>
    <script src="../assets/js/scroll-progress.js"></script>
    <script src="../assets/js/keyboard-shortcuts.js"></script>
    <script src="../assets/js/page-transitions.js"></script>
    <script src="../assets/js/main.js"></script>
  </body>
</html>
